define("com/class",[],function(){function a(a){return e.call(b(a)?a:function(){},a,1)}function b(a){return typeof a===h}function c(a,b,c){return function(){var d=this.supr;this.supr=c[j][a];var e={}.fabricatedUndefined,f=e;try{f=b.apply(this,arguments)}finally{this.supr=d}return f}}function d(a,d,e){for(var f in d)d.hasOwnProperty(f)&&(a[f]=b(d[f])&&b(e[j][f])&&i.test(d[f])?c(f,d[f],e):d[f])}function e(a,c){function e(){}function f(){this.initialize?this.initialize.apply(this,arguments):(c||i&&g.apply(this,arguments),k.apply(this,arguments))}e[j]=this[j];var g=this,h=new e,i=b(a),k=i?a:this,l=i?{}:a;return f.methods=function(a){return d(h,a,g),f[j]=h,this},f.methods.call(f,l).prototype.constructor=f,f.extend=arguments.callee,f[j].implement=f.statics=function(a,b){return a="string"==typeof a?function(){var c={};return c[a]=b,c}():a,d(this,a,g),this},f}var f=this,g=f.klass,h="function",i=/xyz/.test(function(){})?/\bsupr\b/:/.*/,j="prototype";return a.noConflict=function(){return f.klass=g,this},a}),define("com/com",["./observer","./class"],function(a){var b=a("./observer"),c=",touchend,touchmove,touchstart,click,mousemove,",d=",tap,pinch,swipe,rotate,hold,";window.location.search.indexOf("_debug_")>-1&&(window._DEBUG_=!0);var e=b.extend({x:0,y:0,width:0,height:0,rotate:0,scaleX:1,scaleY:1,fillColor:"rgba(0,0,0,1)",lineWidth:0,opacity:1,visible:!0,zIndex:0,behaviors:[],ev_map:{},initialize:function(a){if(a.getContext)this.canvas=a,this.context=this.canvas.getContext("2d"),this.x=this.y=0,this.width=this.canvas.width,this.height=this.canvas.height,this.type="stage";else{for(var b in a)void 0!==a[b]&&(this[b]=a[b]);a.backgroundImage&&(this.backgroundImageWidth=a.backgroundImage.width,this.backgroundImageHeight=a.backgroundImage.height),a.flash&&(this._flashLoop=0)}},append:function(a){this.children=this.children||[],a&&(a.context=this.context,a.stage="stage"==this.type?this:this.stage,this.children.push(a),this.children.sort(function(a,b){return a.zIndex-b.zIndex}))},clear:function(a,b){var b=b||this.context;if(!b)throw"no canvas context for this COM-Object";b.clearRect(this.x+this.lineWidth,this.y+this.lineWidth,this.width+2*this.lineWidth,this.height+2*this.lineWidth)},render:function(a,b){var b=b||this.context;if(!b)throw"no canvas context for this COM-Object";this.fire("render:before",a),b.save(),this._setGraphicStyle(b),b.beginPath(),this._createPath(b),b.closePath(),this._draw(a,b),this._renderChildren(a,b),b.restore(),this.fire("render:after",a)},_renderChildren:function(a,b){if(this.children){b.translate(this.x,this.y);for(var c,d=this.children,e=d.length,f=0;e>f;f++)c=d[f],c.render(a,b)}},_setGraphicStyle:function(a){var b=this.x+this.width/2,c=this.y+this.height/2;this.transform?a.setTransform(this.transform):(a.translate(b,c),this.rotate&&a.rotate(this.rotate*Math.PI/180),(this.scaleX||this.scaleY)&&a.scale(this.scaleX,this.scaleY),(this.skewX||this.skewY)&&a.transform(1,Math.tan(this.skewY*Math.PI/180),Math.tan(this.skewX*Math.PI/180),1,0,0),a.translate(-b,-c)),a.globalAlpha=this.opacity,a.fillStyle=this.fillColor,this.compositeOperation&&(a.globalCompositeOperation=this.compositeOperation),this.font&&(a.font=this.font,a.textAlign="center"),this.strokeColor&&(a.strokeStyle=this.strokeColor),this.lineWidth&&(a.lineWidth=this.lineWidth)},_createPath:function(a){this.shape&&this.shape.draw(this,a)},_draw:function(a,b){return this.visible?(this.painter?this.painter.draw(this,b,a):(this.fillColor&&b.fill(),this.strokeColor&&b.stroke()),void(window._DEBUG_&&(b.strokeStyle="rgba(1,1,1,0.6)",b.lineWidth=2,b.stroke()))):!1},on:function(a,b){var e=this;if(c.indexOf(","+a+",")>-1){var f="stage"==this.type?this:this.stage;f._addEventListener(a,e,function(a){b&&b.call(e,a)},!0)}else d.indexOf(","+a+",")>-1||e.supr(a,b);return e},delegate:function(a,b,d){var e=this;if(c.indexOf(","+a+",")>-1){var f="stage"==this.type?this:this.stage;f._addEventListener(a,e,function(a){b?a.targetCom.id&&a.targetCom.id==b&&d&&d.call(e,a):d&&d.call(e,a)})}return e},_addEventListener:function(a,b,c,d){var e=this.ev_map,f=this;e[a]||(e[a]=[],f.canvas.addEventListener(a,function(a){f._eventTrigger(a||window.event)})),e[a].push({t:b,fn:c,listenSelf:d})},_eventTrigger:function(a){var b,c,d=this.canvas.getBoundingClientRect(),e=this.canvas,f={},g=a.type;if(g.match(/touch/)){var h=a.touches.length?a.touches[0]:a.changedTouches[0];b=h.pageX,c=h.pageY}else b=a.pageX,c=a.pageY;f={x:b-d.left*(e.width/d.width),y:c-d.top*(e.height/d.height)};for(var i=this.ev_map[g],j=0;j<i.length;j++){var k=i[j],l=k.t,m=l._findTarget(f,k.listenSelf);m&&(a.targetCom=m,k.fn.call(l,a))}},_findTarget:function(a,b){function c(f,g){var h=!0;if("stage"==f.type?d=!0:(g.save(),f._setGraphicStyle(g),g.beginPath(),f._createPath(g),g.closePath(),d=g.isPointInPath(a.x,a.y)),d){if(e=f,b)h=!0;else if(f.children){var i=f.children;g.translate(f.x,f.y);for(var j=i.length-1;j>=0;j--){if(i[j].visible&&c(i[j],g)){h=!0;break}h=!1}}}else h=!1;return g.restore(),h}var d,e,f=this,g=f.context;return c(f,g),e}});return e.Shape={Rect:{draw:function(a,b){b.rect(a.x,a.y,a.width,a.height)}},Circle:{draw:function(a,b){var c=a.x+a.width/2,d=a.y+a.height/2,e=a.width/2;b.arc(c,d,e,0,2*Math.PI),b.clip()}}},e.Painter={Text:{draw:function(a,b){b.fillText(a.text,a.x,a.y)}},Bitmap:{draw:function(a,b){var c=a.backgroundImage;if(a.backgroundRepeatX){var d=a.backgroundImageWidth,e=a.backgroundImageHeight,f=a.height/e*d,g=a.imagePositionX||0,h=Math.ceil(a.width/f)+1;a.maxPositionX||(a.maxPositionX=f);for(var i=0;h>i;i++)b.drawImage(c,0,0,d,e,a.x+i*f-g,a.y,f,a.height)}else b.drawImage(c,0,0,c.width,c.height,a.x,a.y,a.width,a.height)}}},e}),define("com/gesture",[],function(){}),define("com/loader",["./observer","./class"],function(a){var b=a("./observer"),c=b.extend({initialize:function(a){this._assetsNum=0,this._loadedNum=0,this._imgMap={};for(var b in a)this._assetsNum++;for(var b in a){var c=a[b];this._loadImag(b,c)}},get:function(a){return this._imgMap[a]},_loadImag:function(a,b){var c,d=this;c=d._imgMap[a]||new Image,c.onload=function(){d._complete(this)},c.onerror=function(){this.retry?d.fire("error",a,b):(this.retry=!0,this.onload=this.onerror=null,d._loadImag(a,b))},c.src=b,d._imgMap[a]=c},_complete:function(a){this._loadedNum++,this._loadedNum==this._assetsNum?this.fire("complete"):this.fire("load",this._loadedNum,a)}});return c}),define("com/observer",["./class"],function(a){var b=a("./class"),c=b({on:function(a,b,c){return this._events=this._events||{},this._events[a]||(this._events[a]=[]),this._events[a].push({fn:b,ctx:c}),this},fire:function(a){this._events=this._events||{};var b,c=this._events[a],d=Array.prototype.slice.call(arguments,1);if(c&&c.length)for(var e=0;e<c.length;e++)b=c[e],b.fn.apply(b.ctx||this,d);return this},off:function(a,b){if(this._events=this._events||{},b){for(var c=0;c<this._events[a].length;c++)if(b==this._events[a][c]){this._events[a].splice(c,1);break}}else delete this._events[a];return this}});return c}),define("com/sprite",["./com","./observer","./class"],function(a){var b=a("./com"),c=b.extend({framerate:0,initialize:function(a){this.supr(a),this.callbackList=[],this.frameLoop=0,this.autoPlay&&this.play(this.firstAnim)},setFrameSpeed:function(a){this.frameTime=1/a},_draw:function(a,b){this.supr(a,b),this.painter&&this._animPlay&&!this.isOver&&(this.frameLoop<this.framerate?this.frameLoop++:(this.frameLoop=0,this.isOver=this.painter.advance(),this.isOver&&this.callbackList.length&&this.callbackList[0]()))},play:function(a,b){if(this.painter){var c=this,d=a?a:this.firstAnim;c._animPlay=!0,c.isOver=!1,c.painter.playAnim(d),b&&this.callbackList.push(function(){b.call(c),c.callbackList.shift()})}},stop:function(){this._animPlay=!1}});return c}),define("com/spriteSheet",["./observer","./class"],function(a){var b=a("./observer"),c=b.extend({frameIndex:0,initialize:function(a){for(var b in a)void 0!==a[b]&&(this[b]=a[b]);if(this.frameData&&!this.frames){for(var c,d=this.frameData,e=d.frameHeight,f=d.frameWidth,g=d.imgHeight,h=d.imgWidth,i=d.frameNum,j=[],k=Math.floor(h/f),l=Math.floor(g/e),m=0;l>m;m++){for(c=0;k>c;c++){var n=[];if(n.push(c*f),n.push(m*e),n.push(f),n.push(e),j.push(n),m*k+c+1>=i)break}if(m*k+c+1>=i)break}this.frames=j}if(this.animations)for(var o in this.animations){this.firstAnim=o;break}else this.maxFrame=this.frames.length-1,this.minFrame=0,this.loop=!1},advance:function(){var a=!1;return this.frameIndex<this.maxFrame?this.frameIndex++:(this.frameIndex=this.minFrame,a=!0,this._loop&&(a=!1)),a},playAnim:function(a){var b=a?a:this.firstAnim;if(this.animations){var c=this.animations[b];this.minFrame=c.start,this.maxFrame=c.end,this.frameIndex=c.start,this._loop=c.loop?!0:!1}},draw:function(a,b){var c=this.frames[this.frameIndex],d=c[0],e=c[1],f=c[2],g=c[3];b.drawImage(this.image,d,e,f,g,a.x,a.y,a.width,a.height)}});return c}),define("com/timer",["./observer","./class"],function(a){var b=a("./observer"),c=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(a,1/60)},d=b.extend({_loop:function(){if(!this._run)return!1;var a=this,b=+new Date,d=a.lastTime;c(function(){a._loop()});var e=(b-d)/1e3;e>2&&(e=1/60),a.fire("run",e),a.lastTime=b},start:function(){return this._run=!0,this.lastTime=+new Date,this._loop(),this},pause:function(){return this._run=!1,this}});return d});