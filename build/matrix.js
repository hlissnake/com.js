window.Matrix=window.Matrix||{},Matrix.Loader=function(a,b){function c(a){this._assetsNum=0,this._loadedNum=0,this._imgMap={};for(var b in a)this._assetsNum++;for(var b in a){var c=a[b];this._loadImag(b,c)}}return a.extend(c,b,{get:function(a){return this._imgMap[a]},_loadImag:function(a,b){var c,d=this;c=d._imgMap[a]||new Image,c.onload=function(){d._complete(this)},c.onerror=function(){this.retry?d.fire("error",a,b):(this.retry=!0,this.onload=this.onerror=null,d._loadImag(a,b))},c.src=b,d._imgMap[a]=c},_complete:function(a){this._loadedNum++,this._loadedNum==this._assetsNum?this.fire("complete"):this.fire("load",this._loadedNum,a)}}),c}(Util.Class,Util.Observer),window.Matrix=window.Matrix||{},Matrix.Timer=function(a,b){function c(){}var d=window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(a){setTimeout(a,1/60)};return a.extend(c,b,{_loop:function(){if(!this._run)return!1;var a=this,b=+new Date,c=a.lastTime;d(function(){a._run&&a._loop()});var e=(b-c)/1e3;e>2&&(e=1/30),a.fire("run",e),a.lastTime=b},start:function(){return this._run=!0,this.lastTime=+new Date,this._loop(),this},pause:function(){return this._run=!1,this}}),c}(Util.Class,Util.Observer);var Game=function(a,b,c,d){function e(){}return a.extend(e,b,{get:function(a){return this.loader.get(a)},init:function(a){var b=this;b.stage=new Com(b.canvas),b.ticker=new c,b.loader=new d(this.assets).on("complete",function(){a.call(b,b.canvas),b.start()})},append:function(a){this.stage.append(a)},update:function(a){var b=this,c=(b.canvas,!1);window.navigator.userAgent.match(/Android/)&&(c=!0),b.ticker.on("run",function(c){a.call(b,c)})},start:function(){this.ticker.start()},pause:function(){this.ticker.pause()},over:function(a){a.call(this,this.dt)}}),e.createScene=function(a,b){var c=new e;return c.canvas=a,c.assets=b.assets,c.init(b.init),c.update(b.update),c},e}(Util.Class,Util.Observer,Matrix.Timer,Matrix.Loader);