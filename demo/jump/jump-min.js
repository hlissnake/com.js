define(function(a){var b=a("com/com"),c=a("com/sprite"),d=a("com/spriteSheet"),e=(a("com/loader"),a("demo/game")),f={runner:"./image/runner.png",hill:"./image/hill.png",sky:"./image/bg.png",blood:"./image/blood.png",ground:"./image/ground.png",start:"./image/start.png",over:"./image/over.png",arrow:"./image/arrow.png"},g=1500,h=50,i=0,j=100,k=60,l=20,m=50*Math.PI/2+j,n=180;return{init:function(){canvas.width=document.body.getBoundingClientRect().width,canvas.height=document.body.getBoundingClientRect().height;var a,o,p,q,r,s,t,u,v=function(a,b,c){var d=a*b*b*g;c.x+=d,c.x<0?c.x=0:c.x>z.canvas.width-c.width&&(c.x=z.canvas.width-c.width),c.framerate=d>0&&!this.Jumping?0:1,c.scaleX=d>=0?1:-1},w=function(a,b){var c={x:a.x+a.width/2,y:a.y+a.height/2,r:a.width/2},d={x:b.x+b.width/2,y:b.y+b.height/2,r:b.width/2},e=Math.sqrt(Math.pow(c.x-d.x,2)+Math.pow(c.y-d.y,2));return e<c.r+d.r},x=function(){p?(o.x=0,o.y=canvas.height-60-90,o.die=!1,o.play("run"),o.visible=!0):(p=new b({x:z.canvas.width,y:z.canvas.height-60-50,width:50,height:50,backgroundImage:z.get("ground"),shape:b.Shape.Circle,painter:b.Painter.Bitmap}).on("render:before",function(a){this.x<-this.width?this.x=z.canvas.width+60*Math.random():this.x-=m*a,this.rotate-=n*a}),z.append(p))},y=e.createScene(canvas);y.init(function(){}),y.init();var z=e.createScene(canvas,{assets:f,init:function(){loading.style.display="none";var e=this.canvas,f=this,g=f.stage,i={over:!0,jump:function(a){var b=this,c=a.y;if(b.over&&!a.die){var d=new TWEEN.Tween({y:c}).to({y:c-h},600).easing(TWEEN.Easing.Quintic.Out).onUpdate(function(){a.y=this.y}),e=new TWEEN.Tween({y:c-h}).to({y:c},600).easing(TWEEN.Easing.Quartic.In).onUpdate(function(){a.y=this.y,a.y==c&&(b.over=!0)});d.chain(e).start(),b.over=!1}}},j=new d({image:z.get("blood"),frameData:{imgWidth:450,imgHeight:64,frameWidth:64,frameHeight:64,frameNum:6}}),k=new d({image:z.get("runner"),frameData:{imgWidth:2048,imgHeight:2048,frameWidth:165,frameHeight:292,frameNum:64},animations:{run:{start:0,end:25,loop:!0},jump:{start:26,end:63},stand:{start:58,end:60,loop:!0}}});a=new b({width:g.width,height:g.height-60,backgroundImage:z.get("sky"),imagePositionX:0,backgroundRepeatX:!0,shape:b.Shape.Rect,painter:b.Painter.Bitmap}),q=new b({y:e.height-60,width:e.width,height:60,backgroundImage:z.get("ground"),imagePositionX:0,backgroundRepeatX:!0,shape:b.Shape.Rect,painter:b.Painter.Bitmap}),u=new b({x:e.width*Math.random(),y:e.height-60-118,width:564,height:118,backgroundImage:z.get("hill"),shape:b.Shape.Rect,painter:b.Painter.Bitmap}),s=new b({id:"start",x:e.width/2-55,y:130,width:110,height:60,backgroundImage:z.get("start"),shape:b.Shape.Rect,painter:b.Painter.Bitmap}),t=new b({id:"gameover",x:e.width/2-99,y:70,width:198,height:50,visible:!1,backgroundImage:z.get("over"),shape:b.Shape.Rect,painter:b.Painter.Bitmap}),r=new c({width:50,height:50,visible:!1,framerate:4,shape:b.Shape.Rect,painter:j}),o=new c({x:50,y:z.stage.height-60-90,width:50,height:90,zIndex:10,shape:b.Shape.Rect,painter:k,loop:!0,autoPlay:!0}),g.append(a),g.append(q),g.append(u),g.append(o),g.append(r),g.append(s),g.append(t),g.on("touchstart",function(){o.die||(o.framerate=1,z.Jumping=!0,o.play("jump",function(){o.framerate=0,z.Jumping=!1,this.play("run")}),i.jump(o))}),g.delegate("touchstart","start",function(){x(),s.visible=!1});window.addEventListener("devicemotion",function(a){z.accelerationX=a.accelerationIncludingGravity.x})},update:function(b){var c=this.stage;q.imagePositionX>=q.maxPositionX?q.imagePositionX=0:q.imagePositionX+=j*b,u.x=u.x<-u.width?c.width+60:u.x-k*b,a.imagePositionX>=a.maxPositionX?a.imagePositionX=0:a.imagePositionX+=l*b,TWEEN.update(),p&&!o.die&&(v(z.accelerationX,b,o),w(o,p)&&(console.log("die"),o.die=!0,r.x=o.x-7,r.y=o.y+13,r.visible=!0,r.play("",function(){r.visible=!1}),dieBehavior.die(o,function(){o.visible=!1,s.visible=!0}))),c.clear(),c.render(b),i+=b,i>1&&(i=0,fps.innerHTML="FPS:"+Math.floor(1/b))}})}}});